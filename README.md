<h1 align="center">向听镜 Shanten Lens  (Beta Test)</h1>
<br/>
<p align="center">
<a href="./README_JA.md">日本語</a>
</p>

## 使用方法

### 前置准备

1. 运行一次向听镜并关闭，用于生成证书等文件

### 安装并配置Proxifier

1. 前往[Proxifier官网](https://www.proxifier.com/)下载并安装Proxifier
2. 在Proxifier中配置服务器。依次点击顶部的Profile->Proxy Servers...->Add...
3. 在弹出的窗口中输入：

    - **Address**: `127.0.0.1`
    - **Port**: `10999`
    - **Protocol**: `HTTPS`

   然后点击 **OK**。

> [!WARNING]  
> 首次添加代理服务器时，Proxifier 可能会弹出 “Do you want Proxifier to use this proxy by default?” 提示框，请选择 **No (否)**。

4. 在 Proxifier 中添加规则：依次点击顶部菜单 **Profile -> Proxification Rules... -> Add...**。
5. 在弹出的窗口中填写：

    - **Name**: 任意名称（按个人喜好即可）
    - **Application**: `Jantama_MahjongSoul.exe`
        - 如果你使用的是客户端，选择对应的 EXE。
        - 如果你使用的是浏览器，请填写对应的进程名，如 `chrome.exe` 或 `msedge.exe`。
    - **Action**: 选择刚刚添加的代理服务器

   然后点击 **OK** 保存。

6. 如果你使用的是浏览器或者使用的是谷歌账号登录，则需要安装证书。前往`%USERPROFILE%\.mitmproxy`文件夹，找到名为`mitmproxy-ca-cert.cer`的文件，双击打开它
7. 在证书向导中按如下步骤操作：

    1. 点击 **安装证书(I)...**
    2. 选择 **本地计算机(L)** -> **下一步**
    3. 选择 **将所有证书都放入下列存储(P)** -> 点击 **浏览**
    4. 选择 **受信任的根证书颁发机构** -> **确定**
    5. 点击 **下一步** -> **完成**

   （这是用于让系统信任本机 HTTPS 代理的根证书，只在你的本机生效。）

8. 启动向听镜和游戏
> [!TIP]  
> 在 Proxifier 未关闭、但向听镜未运行的情况下，游戏将无法正常连接服务器。这是正常现象。

> [!TIP]  
> 你可以根据需要选择以下使用方式之一：
> - 只在需要使用向听镜时才启动 Proxifier 和 向听镜；
> - 始终保持 Proxifier 和 向听镜运行；
> - 使用网页版进行段位赛，客户端专门用于青云之志（客户端可以配合 CE 加速动画）。

---

### 功能介绍
- 主页页面：显示当前拥有的护身符，商品卡包，候选护身符，在打牌阶段会显示牌山，打牌指导，和牌山剩余统计，在换牌阶段还会显示换牌的序列
- 熔断页面：阻止一些会导致致命或不希望看到的结果的行为，询问并确认是否要这样做
- 自动化页面：重复自动进行青云之志，直到拥有护身符达到规定的目标
- 公开牌山设置：将游戏中的所有牌设置为公开牌
- 自动打牌：根据七对子指导自动打牌
- 自动自摸：通过发包自动自摸（不建议使用）
- 防止挂机：通过不断的点击排行榜来防止被判断为挂机，使用时需要打开青云之志或者雀魂段位的排行榜，并且游戏窗口比例需要调整为16:9，建议配合自动化使用

## TODO LIST

- [ ] 重写配置系统
- [x] 添加自动刷护身符[liqi.json](proto/liqi.json)
- [x] 添加~~自定义~~配色方案
- [ ] 重构更新游戏状态的大量重复代码
- [ ] 更灵活的熔断配置