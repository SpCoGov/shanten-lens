<h1 align="center">向聴レンズ Shanten Lens  (Beta Test)</h1>
<br/>
<p align="center">
<a href="./README.md">中国語</a>
</p>

## 使い方

### 事前準備

1. 向聴レンズ（Shanten Lens）を一度起動してから終了し、初期設定ファイルや証明書などを生成しておきます。

### Proxifier のインストールと設定

1. [Proxifier 公式サイト](https://www.proxifier.com/) から Proxifier をダウンロードしてインストールします。
2. Proxifier でプロキシサーバーを設定します。上部メニューの **Profile -> Proxy Servers... -> Add...** を順にクリックします。
3. 表示されたウィンドウで、次のように入力します：

    - **Address**: `127.0.0.1`
    - **Port**: `10999`
    - **Protocol**: `HTTPS`

   入力後、**OK** をクリックします。

   > [!WARNING]  
   > 初めてプロキシサーバーを追加する際、Proxifier が “Do you want Proxifier to use this proxy by default?” というダイアログを表示する場合があります。その場合は **No（いいえ）** を選択してください。

4. Proxifier でプロキシルールを追加します。上部メニューの **Profile -> Proxification Rules... -> Add...** を順にクリックします。
5. 表示されたウィンドウで、次のように設定します：

    - **Name**: 任意の名前（自分のわかりやすい名前で構いません）
    - **Application**: `Jantama_MahjongSoul.exe`
        - クライアント版を使用している場合は、対応する EXE を選択します。
        - ブラウザ版を使用している場合は、`chrome.exe` や `msedge.exe` など、使用しているブラウザのプロセス名を入力します。
    - **Action**: 先ほど追加したプロキシサーバーを選択します。

   設定後、**OK** をクリックして保存します。

6. ブラウザ版を使用している場合、Google アカウントでログインしている場合、またはゲーム／ログイン画面で証明書エラーが表示される場合は、証明書をインストールする必要があります。  
   `%USERPROFILE%\.mitmproxy` フォルダを開き、`mitmproxy-ca-cert.cer` というファイルを探してダブルクリックします。

7. 証明書インポートウィザードで、次の手順に従います：

    1. **証明書のインストール(I)...** をクリック
    2. **ローカル コンピューター(L)** を選択 -> **次へ**
    3. **証明書をすべて次のストアに配置する(P)** を選択 -> **参照** をクリック
    4. **信頼されたルート証明機関** を選択 -> **OK**
    5. **次へ** -> **完了** をクリック

   （これは、ローカルの HTTPS プロキシを OS に信頼させるためのルート証明書で、この PC のみで有効です。）

8. 向聴レンズとゲームを起動します。

> [!TIP]  
> Proxifier が起動したままで、向聴レンズが起動していない場合、ゲームはサーバーに正常に接続できません。これは正常な挙動です。

> [!TIP]  
> 利用スタイルに応じて、次のいずれかの方法を選べます：
> - 向聴レンズを使いたいときだけ Proxifier と向聴レンズを起動する
> - 常に Proxifier と向聴レンズを起動したままにする
> - 段位戦はブラウザ版でプレイし、青雲の志はクライアント版専用にする（クライアント版は CE でアニメーションを高速化できます）

---

### 機能紹介

- ホームページ：所持しているお守り、商品カードパック、候補お守りを表示します。対局中は山牌、打牌ガイド、山牌残り枚数の統計を表示し、交換フェーズでは実際の交換シーケンスも表示します。

- ヒューズページ：重大な不利益や望ましくない結果につながる可能性のある操作をブロックし、実行前に確認ダイアログを表示して誤操作を防ぎます。

- 自動化ページ：青雲の志を自動で周回し、所持しているお守りの数があらかじめ設定した目標値に達するまで繰り返します。

- 公開山牌：ゲーム内のすべての牌情報をローカルで公開状態として表示し、解析や研究をしやすくします。

- 自動打牌：七対子の方針に基づいて自動で打牌を行います。

- 自動ツモ：パケット送信によって自動ツモを行う機能です（使用は推奨しません）。

- AFK防止：ランキング画面を定期的にクリックすることで、放置判定を避ける機能です。利用時は青雲の志または雀魂段位戦のランキング画面を開き、ゲームウィンドウの比率を 16:9 に調整する必要があります。自動化機能と併用することを推奨します。